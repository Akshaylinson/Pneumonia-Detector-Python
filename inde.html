<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pneumonia Detector | Medical AI Assistant</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --success: #2ecc71;
      --danger: #e74c3c;
      --warning: #f39c12;
      --light: #f8f9fa;
      --dark: #343a40;
      --gray: #6c757d;
      --border-radius: 12px;
      --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--dark);
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
    }

    .logo-icon {
      font-size: 2.5rem;
      color: var(--primary);
    }

    h1 {
      font-size: 2.5rem;
      color: var(--dark);
      margin-bottom: 10px;
    }

    .subtitle {
      font-size: 1.1rem;
      color: var(--gray);
      max-width: 600px;
      margin: 0 auto;
    }

    .card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 30px;
      margin-bottom: 30px;
      transition: var(--transition);
    }

    .card:hover {
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.15);
    }

    .card-title {
      font-size: 1.5rem;
      margin-bottom: 20px;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title i {
      color: var(--primary);
    }

    .upload-area {
      border: 2px dashed #ced4da;
      border-radius: var(--border-radius);
      padding: 40px 20px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
      margin-bottom: 20px;
      position: relative;
    }

    .upload-area:hover {
      border-color: var(--primary);
      background-color: rgba(52, 152, 219, 0.05);
    }

    .upload-area.active {
      border-color: var(--primary);
      background-color: rgba(52, 152, 219, 0.1);
    }

    .upload-icon {
      font-size: 3rem;
      color: var(--gray);
      margin-bottom: 15px;
    }

    .upload-text {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    .upload-hint {
      color: var(--gray);
      font-size: 0.9rem;
    }

    #fileInput {
      display: none;
    }

    .preview-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }

    #preview {
      max-width: 100%;
      max-height: 400px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      display: none;
    }

    .btn {
      display: inline-block;
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
    }

    .btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      background: var(--gray);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .btn-lg {
      padding: 15px 30px;
      font-size: 1.1rem;
    }

    .btn-block {
      display: block;
      width: 100%;
    }

    .result-container {
      display: none;
      margin-top: 30px;
    }

    .result-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 25px;
      margin-bottom: 20px;
    }

    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .result-title {
      font-size: 1.3rem;
      color: var(--dark);
    }

    .confidence-badge {
      background: var(--primary);
      color: white;
      padding: 8px 16px;
      border-radius: 50px;
      font-weight: 600;
    }

    .result-details {
      margin-top: 15px;
    }

    .probability-meter {
      margin: 15px 0;
    }

    .probability-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .probability-bar {
      height: 10px;
      background: #e9ecef;
      border-radius: 5px;
      overflow: hidden;
    }

    .probability-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    .alert {
      padding: 15px;
      border-radius: var(--border-radius);
      margin: 15px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .alert-danger {
      background: rgba(231, 76, 60, 0.1);
      border-left: 4px solid var(--danger);
      color: var(--danger);
    }

    .alert-success {
      background: rgba(46, 204, 113, 0.1);
      border-left: 4px solid var(--success);
      color: #27ae60;
    }

    .alert-warning {
      background: rgba(243, 156, 18, 0.1);
      border-left: 4px solid var(--warning);
      color: #d35400;
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .spinner {
      border: 5px solid rgba(52, 152, 219, 0.2);
      border-radius: 50%;
      border-top: 5px solid var(--primary);
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .info-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .info-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
    }

    .info-card h3 {
      margin-bottom: 15px;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-card ul {
      padding-left: 20px;
    }

    .info-card li {
      margin-bottom: 8px;
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      color: var(--gray);
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .container {
        padding: 0 10px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .card {
        padding: 20px;
      }
      
      .info-section {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-lungs logo-icon"></i>
        <h1>Pneumonia Detector</h1>
      </div>
      <p class="subtitle">Upload a chest X-ray image to analyze for signs of pneumonia using our advanced AI model</p>
    </header>

    <div class="card">
      <h2 class="card-title"><i class="fas fa-upload"></i> Upload X-Ray Image</h2>
      
      <div class="upload-area" id="uploadArea">
        <i class="fas fa-cloud-upload-alt upload-icon"></i>
        <p class="upload-text">Drag & drop your chest X-ray image here</p>
        <p class="upload-hint">or click to browse files (JPG, PNG formats supported)</p>
        <input type="file" id="fileInput" name="file" accept="image/*" required />
      </div>

      <div class="preview-container">
        <img id="preview" alt="X-ray preview" />
      </div>

      <button id="analyzeBtn" class="btn btn-lg btn-block" disabled>
        <i class="fas fa-search"></i> Analyze X-Ray Image
      </button>

      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Analyzing X-ray image. This may take a few seconds...</p>
      </div>

      <div id="error" class="alert alert-danger" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="errorText"></span>
      </div>
    </div>

    <div class="result-container" id="resultContainer">
      <div class="result-card">
        <div class="result-header">
          <h2 class="result-title">Analysis Results</h2>
          <div class="confidence-badge" id="confidenceBadge">0%</div>
        </div>
        
        <div id="resultAlert" class="alert" style="display: none;">
          <i class="fas fa-info-circle"></i>
          <span id="resultText"></span>
        </div>
        
        <div class="result-details">
          <h3>Detailed Probabilities</h3>
          <div id="probabilityMeters"></div>
        </div>
      </div>
    </div>

    <div class="info-section">
      <div class="info-card">
        <h3><i class="fas fa-info-circle"></i> About Pneumonia</h3>
        <p>Pneumonia is an infection that inflames the air sacs in one or both lungs. The air sacs may fill with fluid or pus, causing cough with phlegm or pus, fever, chills, and difficulty breathing.</p>
      </div>
      
      <div class="info-card">
        <h3><i class="fas fa-lightbulb"></i> How It Works</h3>
        <p>Our AI model analyzes chest X-ray images using a Vision Transformer (VIT) architecture to detect patterns associated with pneumonia. The system provides probability scores for different conditions.</p>
      </div>
      
      <div class="info-card">
        <h3><i class="fas fa-exclamation-triangle"></i> Important Notes</h3>
        <ul>
          <li>This tool is for informational purposes only</li>
          <li>Consult a healthcare professional for medical diagnosis</li>
          <li>Ensure X-ray images are clear and properly oriented</li>
          <li>Results are not a substitute for professional medical advice</li>
        </ul>
      </div>
    </div>

    <footer>
      <p>Pneumonia Detector &copy; 2023 | Medical AI Assistant</p>
      <p>This tool uses advanced machine learning to assist in medical image analysis</p>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const uploadArea = document.getElementById('uploadArea');
      const fileInput = document.getElementById('fileInput');
      const preview = document.getElementById('preview');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const loading = document.getElementById('loading');
      const error = document.getElementById('error');
      const errorText = document.getElementById('errorText');
      const resultContainer = document.getElementById('resultContainer');
      const resultAlert = document.getElementById('resultAlert');
      const resultText = document.getElementById('resultText');
      const confidenceBadge = document.getElementById('confidenceBadge');
      const probabilityMeters = document.getElementById('probabilityMeters');
      
      // Upload area click handler
      uploadArea.addEventListener('click', () => {
        fileInput.click();
      });
      
      // Drag and drop functionality
      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('active');
      });
      
      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('active');
      });
      
      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('active');
        
        if (e.dataTransfer.files.length) {
          fileInput.files = e.dataTransfer.files;
          handleFileSelection();
        }
      });
      
      // File input change handler
      fileInput.addEventListener('change', handleFileSelection);
      
      function handleFileSelection() {
        const file = fileInput.files[0];
        if (!file) return;
        
        // Validate file type
        if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
          showError('Please select a JPG or PNG image file');
          return;
        }
        
        // Reset previous results and errors
        hideError();
        hideResults();
        
        // Show preview
        const reader = new FileReader();
        reader.onload = function(e) {
          preview.src = e.target.result;
          preview.style.display = 'block';
          analyzeBtn.disabled = false;
        };
        reader.readAsDataURL(file);
      }
      
      // Analyze button click handler
      analyzeBtn.addEventListener('click', async () => {
        const file = fileInput.files[0];
        if (!file) {
          showError('Please select an image first');
          return;
        }
        
        // Show loading state
        loading.style.display = 'block';
        analyzeBtn.disabled = true;
        hideError();
        hideResults();
        
        try {
          // Prepare form data
          const formData = new FormData();
          formData.append('file', file);
          
          // Send request to server
          const response = await fetch('/predict', {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            throw new Error(`Server error: ${response.status}`);
          }
          
          const data = await response.json();
          
          // Display results
          displayResults(data);
          
        } catch (err) {
          showError('Failed to analyze image: ' + err.message);
        } finally {
          loading.style.display = 'none';
          analyzeBtn.disabled = false;
        }
      });
      
      function displayResults(data) {
        // Extract data from response
        const topLabel = data.top_label || 'Unknown';
        const topProb = data.top_prob || 0;
        const probs = data.probs || {};
        
        // Update confidence badge
        confidenceBadge.textContent = `${(topProb * 100).toFixed(1)}%`;
        
        // Set result text and styling based on prediction
        if (topLabel.toLowerCase().includes('pneumonia')) {
          resultAlert.className = 'alert alert-danger';
          resultText.innerHTML = `<strong>Potential pneumonia detected.</strong> This X-ray shows characteristics that may indicate pneumonia. Please consult a healthcare professional for further evaluation.`;
        } else {
          resultAlert.className = 'alert alert-success';
          resultText.innerHTML = `<strong>No signs of pneumonia detected.</strong> This X-ray appears normal. However, always consult with a healthcare professional for a definitive diagnosis.`;
        }
        
        // Create probability meters
        probabilityMeters.innerHTML = '';
        for (const [label, prob] of Object.entries(probs)) {
          const probabilityMeter = document.createElement('div');
          probabilityMeter.className = 'probability-meter';
          
          const probabilityLabel = document.createElement('div');
          probabilityLabel.className = 'probability-label';
          probabilityLabel.innerHTML = `
            <span>${label}</span>
            <span>${(prob * 100).toFixed(1)}%</span>
          `;
          
          const probabilityBar = document.createElement('div');
          probabilityBar.className = 'probability-bar';
          
          const probabilityFill = document.createElement('div');
          probabilityFill.className = 'probability-fill';
          probabilityFill.style.width = `${prob * 100}%`;
          
          probabilityBar.appendChild(probabilityFill);
          probabilityMeter.appendChild(probabilityLabel);
          probabilityMeter.appendChild(probabilityBar);
          
          probabilityMeters.appendChild(probabilityMeter);
        }
        
        // Show result container and alert
        resultContainer.style.display = 'block';
        resultAlert.style.display = 'flex';
      }
      
      function showError(message) {
        errorText.textContent = message;
        error.style.display = 'flex';
      }
      
      function hideError() {
        error.style.display = 'none';
      }
      
      function hideResults() {
        resultContainer.style.display = 'none';
        resultAlert.style.display = 'none';
      }
    });
  </script>
</body>
</html>
